---
title: "DID analysis"
output: html_document
date: "2025-04-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(tidyverse)
```

```{r}
library(readxl)
Illinois_and_National_Crime_Stats <- read_excel("Raw Data/Illinois and National Crime Stats.xlsx")
View(Illinois_and_National_Crime_Stats)
```

```{r}
#Test DID analysis - using CPD reported Crime statistics
test1 <- Illinois_and_National_Crime_Stats |>
  filter(Year != 2020) |>
  select(Year, `Illinois - TIC Offenses`, `Rest of Illinois - CPD-TIC`, `Chicago PD - Reported Total Index Crime`) |>
  rename(Illinois = `Illinois - TIC Offenses`,
         Non_Chicago = `Rest of Illinois - CPD-TIC`,
         Chicago = `Chicago PD - Reported Total Index Crime`)
```

```{r}
test1 <- test1 |>
  pivot_longer(cols = c(Illinois, Non_Chicago, Chicago), names_to = "Area") |>
  mutate(time = ifelse(Year > 2012, 1, 0)) |>
  mutate(treated = ifelse(Area == "Chicago", 1, 0)) |>
  mutate(did = time*treated)
```

```{r}
didreg = lm(value ~ treated + time + did, data = test1)
summary(didreg)
```

```{r}
didreg1 = lm(value ~ treated*time, data = test1)
summary(didreg1)
```
```{r}
library(stargazer)

# Example using a DiD model with 'feols'
fe_model <- feols(value ~ did | group_id + year, data = test1)

# Export results to LaTeX (or Word)
stargazer(didreg, type = "latex", out = "DID_results.tex")  # To export LaTeX
# stargazer(fe_model, type = "text", out = "DID_results.txt")  # To export text
```

